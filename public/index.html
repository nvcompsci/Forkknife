<!doctype html> 
<html lang="en"> 
<head> 
	<meta charset="UTF-8" />
    <title>p5 Starter</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.7.2/p5.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">

//Global variables accesible by all methods
var pie
var storm
var trees = []
var enemy
var game = {
    images: {},
    projectiles: [],
    sprites: []
}
    
function preload() {
    game.images.fork = loadImage('fork.png')
    //Instantiate the characters
    pie = new Character('pumpkin.png')
    storm = new Storm()
    enemy = new EnemyAI('crab.png')
    game.sprites.push(storm, pie, enemy)
}    
    
function setup() {    
    createCanvas(1200,800)
    for (let i = 0; i < 12; i++) {
        //put new tree x in trees
        trees.push( random(1200) )
    }
}

//This automatically repeats 60 times / second
function draw() {
    background(200)
    game.sprites
        .filter(sprite => sprite.active)
        .forEach(sprite => {
            sprite.update()
            sprite.draw()
        })
    //trees.forEach( (treeX) => ellipse(treeX, 10, 10, 10) )
}
    
function forkVsPlayer (fork) {
    
}

function forkVsEnemy (fork) {
    
}
    
function stormVsCharacter (character) {
    
}
    
function keyPressed() {
    if (keyCode === UP_ARROW || key === 'w')
        pie.vy = -5
    if (keyCode === DOWN_ARROW || key === 's')
        pie.vy = 5
    if (keyCode === RIGHT_ARROW || key === 'd')
        pie.vx = 5
    if (keyCode === LEFT_ARROW || key === 'a')
        pie.vx = -5
}
    
function keyReleased() {
    if (keyCode === RIGHT_ARROW
        || keyCode === LEFT_ARROW
        || key === 'd'
        || key === 'a'
       ) pie.vx = 0
    if (keyCode === UP_ARROW
        || keyCode === DOWN_ARROW
        || key === 'w'
        || key === 's'
       ) pie.vy = 0
    if (keyCode === 32)
        pie.shoot()
}
    
class Character {
    constructor(imgURL) {
        this.x = 100
        this.y = 100
        this.vx = 0
        this.vy = 0
        this.width = 50
        this.height = 50
        this.hp = 100
        this.img = loadImage(imgURL)
        this.active = true
    }
    
    draw() {
        image(this.img, this.x, this.y, this.width, this.height)
    }
    
    update() {
        this.x += this.vx
        this.y += this.vy
    }
    
    shoot() {
        const projectile = new Projectile(this.x + this.width, this.y, "fork", this.vx)
        game.projectiles.push(projectile)
        game.sprites.push(projectile)
    }
}
    
class EnemyAI extends Character {
    constructor(imgURL) {
        super(imgURL)
        this.x = 1000
        this.y = 700
        this.vx = -1
        this.vy = -1
    }
    
    //@Override    
    update() {
        this.x += this.vx
        this.y += this.vy
        
        if (2 > 3)
            this.shoot()
    }
}
    
class Projectile {
    constructor(x, y, type, vx) {
        this.x = x
        this.y = y
        this.vx = vx || 3
        this.width = 30
        this.height = 30
        this.type = type
        if (type == "fork")
            this.img = game.images.fork
        this.active = true
    }
    
    draw() {
        image(this.img, this.x, this.y, this.width, this.height)
    }
    
    update() {
        this.x += this.vx
    }
}
    
class Storm {
    constructor() {
        this.width = 1200
        this.active = true
    }
    
    /**
    * Draws the storm as a white circle with red outline
    */
    draw() {
        //sets outline color to red
        stroke("red")
        //draws circle in center of screen
        //"width" is width of canvas
        //255 represents maximum brightness, i.e. white
        fill(255)
        ellipse(width/2, height/2, this.width)
    }
    
    /**
    * Makes circle shrink over time
    */
    update() {
        //"if" necessary to prevent width going negative
        if (this.width > 0) {
            this.width -= 0.3
        }
    }

}

</script>

</body>
</html>